Habr β How to become an author My feed All streams Development Administrating Design Management Marketing PopSci Search Write a publication Settings Login Pull to refresh 728.35 Rating VK Building the Internet Subscribe Cher Dec 3 2013 at 13:48 Как это сделано: префиксный поиск Reading time 5 min Views 45K VK corporate blog Website development * Search engines * Мы живем во времена, когда кажется, что все просто и все есть. Нужно сделать масштабируемый проект — используем MongoDB, нужна очередь — вот RabbitMQ, нужно поднять функционал поиска — раз плюнуть: ставим Sphinx, Solr, ElasticSearch (нужное подчеркнуть). Но здесь лишь доля правды: — при определенном везении можно поставить нужный сервер и все зашевелится. Загвоздка с поиском состоит в том, что пользователи уже порядком привыкли к высокой планке, которую задают «большие ребята», а тот поиск, что поднимется у вас «из коробки», будет явно недотягивать. И если очередь или базу данных вы можете добить железом прежде, чем будете оптимизировать, то поиск железом не добьешь. Существую толстые книжки про настройки полнотекстового поиска, однако их мало кто читает. Сегодня я хотел бы на пальцах поговорить о том, что нужно учесть, когда вы делаете префиксный поиск с выводом результатов по мере набора слова или фразы. Мы посмотрим, как с помощью нашего проекта http://indexisto.com сделан поиск на сайте http://maximonline.ru и сравним его с тем, что есть на других сайтах. Для начала несколько примеров. Возьмем запрос «Битва за Лос Анджелес» и представим, что его напишут неправильно «Лос Анжелес биттва» . Как видно, пользователь не знает точно, как пишется имя города, и забыл, как звучит название фильма, а также у него дрогнула рука в конце на слове «битва». Выберем достойные проекты рунета, в которых есть префиксный поиск, и попробуем поискать там наш запрос: Проект Правильный запрос Неправильный запрос afisha.ru все ОК Не найдено ivi.ru все ОК Не найдено vk.com все ОК Не найдено maximonline.ru все ОК все ОК Как видно из нашего небольшого исследования, ситуация далека от идеальной. Вот типичные проблемы Не работает перестановка слов Наблюдаются «скачки». То есть по мере набора искомый фильм то появляется в результатах, то пропадает. Отсутствие нечеткого поиска Не у всех есть морфология Поехали настраивать В статье речь будет идти о сервере ElasticSearch, однако эти же подходы можно использовать и при настройке SOLR, так как в итоге все высокоуровневые запросы все равно мапятся на запросы более низкоруровневой библиотеки поиска Lucene. Также не принципиально, делаете ли вы префиксный поиск с помощью ngram токенизаторов или с помощью префиксных запросов (довольно тяжеловесных, так как они мапятся на fuzzy-запросы). Индексация При индексации текст проходит через токенизатор и ряд фильтров (морфология, синонимы...). Оригинальное слово в итоге может быть заменено, приведено к нормальной форме или вообще выкинуто. Через какие бы фильтры вы ни прогоняли ваши токены, сохраняйте оригинальное слово в той же позиции, что и измененное/замененное. Что может случиться, если не сохранить оригинальное слово, показанно на картинке: Как видите, фильтр морфологии меняет слово (приводит к нормальной форме). В обычном поиске это работает хорошо, так как слово из запроса, который ввел пользователь, тоже будет приведено к нормальной форме. Но что делать, пока пользователь ввел только половину слова (префиксный поиск)? Сохраняем оригинальный токен в индексе! У нас, кстати, возникли проблемы в стандартных плагинах Lucene, и мы сделали свои, которые лучше работают с позициями токенов в документе и сохранением оригинального слова. О том, какие проблемы вас могут поджидать, можно почитать, например, здесь: Lucene's TokenStreams are actually graphs! Анализаторы запроса Не используйте анализаторы, которые могут вам «подчистить» запрос, например, фильтр стоп-слов, который удаляет междометия и частицы. Вот пример: Как видите, «а» это стоп-слово, и анализатор запроса ее удалил. На практике это означает, что будет «скачок», то есть человек набрал «Хаунита А» и видит документ по запросу Хуанита (без А). Если у нас много Хуанит в выдаче, то нет никакой гарантии, что нужная нам будет сверху. Для того, чтобы это побороть, убираем фильтр стоп-слов из запроса: Запрос Не пытайтесь сделать все сразу одним путанным гигантским запросом. Разбейте задачу на подзадачи. Существуют булевы и dismax-запросы, которые помогут вам склеить результаты работы нескольких мелких запросов в один. Используйте boost в небольших запросах, чтобы, к примеру, увеличить вес точного совпадения в title страницы по сравнению с совпадением в body страницы. Примерно вот так: { "query":{ "bool" : { "should" : [ { "custom_boost_factor": { "query":{ "match":{ .... } }, "boost_factor": 100 } }, { "custom_boost_factor": { "query":{ "match":{ .... } } }, "boost_factor": 10 } }, ..... ] } } } Точное совпадение фразы в заголовке статьи Итак, наш поисковый запрос состоит из кучки маленьких запросов с разными boost-факторами. Boost-фактор — это множитель релевантности, который применяется, когда базовая текстовая релевантность уже посчитана. Сначала у нас идет поиск на точное совпадение фразы в заголовке статьи (или title страницы). Точное совпадение означает, что мы не используем префикс. Например, запрос «КАК» выведет первыми статьи « Как правильно…» , а не статью «Выращиваем как тус» . Документы, найденные по такому запросу, получают буст, к примеру, 10000. Префиксное совпадение фразы в заголовке статьи Далее идет запрос на префиксное совпадние фарзы. Точные совпадения слова «КАК» нам уже нашел первый запрос, теперь время поискать « как тусы» . Эти документы будут идти ниже точных совпадений за счет меньшего буста. Мы также здесь используем параметр slop, который говорит, что слова в фразе могут отстоять друг от друга на несколько позиций вперед или назад. Многие забывают про этот параметр, а по умолчанию префиксный поиск ищет только вперед. Вот какая выдача получается на текущий момент: Первыми идут точные совпадения, вторыми — префиксные. Совпадения в теле статьи — полное и префиксное Совпадения в заголовке мы нашли и сделали им приличный буст. Время перейти к самому телу статьи. В первую очередь мы опять ищем точное совпадение, и с меньшим boost-фактором префиксные совпадения. Таким образом, совпадения в заголовке будут первыми в выдаче, а совпадения в теле статьи — ниже. Встает вопрос: не отдать ли подобную сортировку на откуп текстовой релевантности? Ведь стандартные алгоритмы учитывают длину текста, в котором найдено совпадение: чем короче текст, тем выше релевантность. Однако практика показала, что при префиксном поиске в теле статьи будет очень много совпадений. Представьте, вы набрали 1-2 буквы, а в теле статьи будет уже 200-300 совпадений, и, несмотря на длину текста, они перебьют релевантность совпадений в заголовке. Нечеткие совпадения в заголовке или теле статьи Последним (за счет буста) идет нечеткий поиск. Нечеткий поиск прощает некоторые опечатки в поисковом запросе, введенном пользователем. Внутри запроса используется Levenshtein distance . Нечеткий запрос имеет несколько настроек, которые выступают в качестве параметров к алгоритму, а также есть возможность указать минимальное необходимое совпадение префикса. "custom_boost_factor": { "query":{ "multi_match":{ "query":"${q}", "fuzziness":0.005, "prefix_length" : 2, "operator":"and", "max_expansions":999, "fields":[ "article_name", "article_body" ] } }, "boost_factor": 1 } } Совпадения, найденные нечетким поиском, идут в самом низу за счет минимального boost-фактора. Что в итоге На картинке видно, как выстроились наши результаты в зависимости от совпадений: в заголовке точные в заголовке по префиксу в теле статьи точные в теле статьи по префиксу в заголовке и теле статьи нечеткие (с опечатками) Бонус-трек для тех, кто осилил статью Мы собираем всю статистику поисковых запросов, клики по результатам выдачи, поиски без переходов, поиски с пустым результатом. Интересно, что на maximonline.ru поиск довольно востребованный функционал, а 90% поисковых запросов это имена девушек. Здесь можно получить очень интересные данные :) Итак, самые искомые читателями Maxim девушки в обратном порядке! Данные за ноябрь 2013. 5. Анна Семенович (телеведущая) 4. Вера Брежнева (певица) 3. Анна Хилькевич (актриса) 2. Мария Горбань (актриса) 1. Екатерина Волкова (актриса) Tags: elasticsearch поисковые системы поиск по сайту lucene Hubs: VK corporate blog Website development Search engines Total votes 103: ↑81 and ↓22 +59 Add to bookmarks 335 Comments 37 VK Building the Internet 106 Karma 0 Rating Cher @Cher User Follow Send message Comments Comments 37 Articles Top of the day Similar articles Information Website vk.com Registered August 9 2008 Founded October 15 1998 Employees 5,001–10,000 employees Location Россия Representative Миша Берггрен Your account Log in Sign up Sections Articles News Hubs Authors Sandbox Information How it works For authors For companies Documents Agreement Confidential Services Corporate blogs Advertising Native advertising Education programs Startups Facebook Twitter Telegram Language settings Support © 2006–2025, Habr window.__INITIAL_STATE__={"adblock":{"hasAcceptableAdsFilter":false,"hasAdblock":false},"articlesList":{"articlesList":{"204654":{"id":"204654","timePublished":"2013-12-03T09:48:07+00:00","isCorporative":true,"lang":"ru","titleHtml":"Как это сделано: префиксный поиск","leadData":{"textHtml":"Мы живем во времена, когда кажется, что все просто и все есть. Нужно сделать масштабируемый проект — используем MongoDB, нужна очередь — вот RabbitMQ, нужно поднять функционал поиска — раз плюнуть: ставим Sphinx, Solr, ElasticSearch (нужное подчеркнуть). \u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nНо здесь лишь доля правды: — при определенном везении можно поставить нужный сервер и все зашевелится. Загвоздка с поиском состоит в том, что пользователи уже порядком привыкли к высокой планке, которую задают «большие ребята», а тот поиск, что поднимется у вас «из коробки», будет явно недотягивать. И если очередь или базу данных вы можете добить железом прежде, чем будете оптимизировать, то поиск железом не добьешь.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nСуществую толстые книжки про настройки полнотекстового поиска, однако их мало кто читает. Сегодня я хотел бы на пальцах поговорить о том, что нужно учесть, когда вы делаете префиксный поиск с выводом результатов по мере набора слова или фразы. \u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nМы посмотрим, как с помощью нашего проекта \u003Ca href=\"http:\u002F\u002Findexisto.com\u002F\"\u003Ehttp:\u002F\u002Findexisto.com\u003C\u002Fa\u003E сделан поиск на сайте \u003Ca href=\"http:\u002F\u002Fmaximonline.ru\u002F\"\u003Ehttp:\u002F\u002Fmaximonline.ru\u003C\u002Fa\u003E и сравним его с тем, что есть на других сайтах.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nДля начала несколько примеров. Возьмем запрос \u003Cb\u003E«Битва за Лос Анджелес»\u003C\u002Fb\u003E и представим, что его напишут неправильно \u003Cb\u003E«Лос Анжелес биттва»\u003C\u002Fb\u003E. Как видно, пользователь не знает точно, как пишется имя города, и забыл, как звучит название фильма, а также у него дрогнула рука в конце на слове «битва».\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nВыберем достойные проекты рунета, в которых есть префиксный поиск, и попробуем поискать там наш запрос:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ctable\u003E\r\n\u003Ctr\u003E\r\n\u003Cth\u003EПроект\u003C\u002Fth\u003E\r\n\u003Cth\u003EПравильный запрос\u003C\u002Fth\u003E\r\n\u003Cth\u003EНеправильный запрос\u003C\u002Fth\u003E\r\n\u003C\u002Ftr\u003E\r\n\u003Ctr\u003E\r\n\u003Ctd\u003Eafisha.ru\u003Cbr\u002F\u003E\r\n\u003C\u002Ftd\u003E\r\n\u003Ctd\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fpost_images\u002F33e\u002Fc81\u002Fc7c\u002F33ec81c7cb6e6b66eb86b16c66d86cac.png\"\u002F\u003E\u003Cbr\u002F\u003E\r\n\u003Ci\u003Eвсе ОК\u003C\u002Fi\u003E\u003Cbr\u002F\u003E\r\n\u003C\u002Ftd\u003E\r\n\u003Ctd\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fpost_images\u002Fb45\u002F7e3\u002Fef0\u002Fb457e3ef074e9cf0de0f7980bbbd2c17.png\"\u002F\u003E\u003Cbr\u002F\u003E\r\n\u003Ci\u003EНе найдено\u003C\u002Fi\u003E\u003Cbr\u002F\u003E\r\n\u003C\u002Ftd\u003E\r\n\u003C\u002Ftr\u003E\r\n\u003Ctr\u003E\r\n\u003Ctd\u003Eivi.ru\u003Cbr\u002F\u003E\r\n\u003C\u002Ftd\u003E\r\n\u003Ctd\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fpost_images\u002Fa45\u002F86d\u002F492\u002Fa4586d49296f2a7793881a3d2d2ee485.png\"\u002F\u003E\u003Cbr\u002F\u003E\r\n\u003Ci\u003Eвсе ОК\u003C\u002Fi\u003E\u003Cbr\u002F\u003E\r\n\u003C\u002Ftd\u003E\r\n\u003Ctd\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fpost_images\u002Fc51\u002F426\u002F84b\u002Fc5142684bd7e03b39bbec4495be210d8.png\"\u002F\u003E\u003Cbr\u002F\u003E\r\n\u003Ci\u003EНе найдено\u003C\u002Fi\u003E\u003Cbr\u002F\u003E\r\n\u003C\u002Ftd\u003E\r\n\u003C\u002Ftr\u003E\r\n\u003Ctr\u003E\r\n\u003Ctd\u003Evk.com\u003Cbr\u002F\u003E\r\n\u003C\u002Ftd\u003E\r\n\u003Ctd\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fpost_images\u002F58c\u002F729\u002F7ec\u002F58c7297ec5daa02f037d9047c6c455d0.png\"\u002F\u003E\u003Cbr\u002F\u003E\r\n\u003Ci\u003Eвсе ОК\u003C\u002Fi\u003E\u003Cbr\u002F\u003E\r\n\u003C\u002Ftd\u003E\r\n\u003Ctd\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fpost_images\u002Fcf2\u002F715\u002Ff39\u002Fcf2715f39df2a0f74ea85ccd5aa2ef5a.png\"\u002F\u003E\u003Cbr\u002F\u003E\r\n\u003Ci\u003EНе найдено\u003C\u002Fi\u003E\u003Cbr\u002F\u003E\r\n\u003C\u002Ftd\u003E\r\n\u003C\u002Ftr\u003E\r\n\u003Ctr\u003E\r\n\u003Ctd\u003Emaximonline.ru\u003Cbr\u002F\u003E\r\n\u003C\u002Ftd\u003E\r\n\u003Ctd\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fpost_images\u002F20f\u002F9e3\u002F38a\u002F20f9e338aaebab27e3404f219b422d52.png\"\u002F\u003E\u003Cbr\u002F\u003E\r\n\u003Ci\u003Eвсе ОК\u003C\u002Fi\u003E\u003Cbr\u002F\u003E\r\n\u003C\u002Ftd\u003E\r\n\u003Ctd\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fpost_images\u002F327\u002F6ad\u002Fb90\u002F3276adb902950ba3b1fba84dcd640099.png\"\u002F\u003E\u003Cbr\u002F\u003E\r\n\u003Ci\u003Eвсе ОК\u003C\u002Fi\u003E\u003Cbr\u002F\u003E\r\n\u003C\u002Ftd\u003E\r\n\u003C\u002Ftr\u003E\r\n\u003C\u002Ftable\u003E\u003Cbr\u002F\u003E\r\n","imageUrl":null,"buttonTextHtml":"Читать дальше &rarr;","image":null},"editorVersion":"1.0","postType":"article","postLabels":[],"author":{"id":"9645","alias":"Cher","fullname":"Cher","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002F9da\u002Fdbf\u002F3be\u002F9dadbf3bea9addad8325ab253d6939f8.jpg","speciality":null,"scoreStats":{"score":106,"votesCount":190},"rating":0,"relatedData":null,"contacts":[],"authorContacts":[],"paymentDetails":{"paymentYandexMoney":null,"paymentPayPalMe":null,"paymentWebmoney":null},"donationsMethod":null,"isInBlacklist":null,"careerProfile":null},"statistics":{"commentsCount":37,"favoritesCount":335,"readingCount":44613,"score":59,"votesCount":103,"votesCountPlus":81,"votesCountMinus":22},"hubs":[{"id":"4992","alias":"vk","type":"corporative","title":"VK corporate blog","titleHtml":"VK corporate blog","isProfiled":false,"relatedData":null},{"id":"91","alias":"webdev","type":"collective","title":"Website development","titleHtml":"Website development","isProfiled":true,"relatedData":null},{"id":"126","alias":"search_technologies","type":"collective","title":"Search engines","titleHtml":"Search engines","isProfiled":true,"relatedData":null}],"flows":[{"id":"1","alias":"develop","title":"Development","titleHtml":"Development"}],"relatedData":{"vote":null,"unreadCommentsCount":0,"bookmarked":false,"canComment":false,"canEdit":false,"canViewVotes":false,"votePlus":{"canVote":false,"isChargeEnough":false,"isKarmaEnough":false,"isVotingOver":true,"isPublicationLimitEnough":false},"voteMinus":{"canVote":false,"isChargeEnough":false,"isKarmaEnough":false,"isVotingOver":true,"isPublicationLimitEnough":false},"canModerateComments":false,"trackerSubscribed":false,"emailSubscribed":false},"textHtml":"\u003Cdiv xmlns=\"http:\u002F\u002Fwww.w3.org\u002F1999\u002Fxhtml\"\u003EМы живем во времена, когда кажется, что все просто и все есть. Нужно сделать масштабируемый проект — используем MongoDB, нужна очередь — вот RabbitMQ, нужно поднять функционал поиска — раз плюнуть: ставим Sphinx, Solr, ElasticSearch (нужное подчеркнуть). \u003Cbr\u002F\u003E\n\u003Cbr\u002F\u003E\nНо здесь лишь доля правды: — при определенном везении можно поставить нужный сервер и все зашевелится. Загвоздка с поиском состоит в том, что пользователи уже порядком привыкли к высокой планке, которую задают «большие ребята», а тот поиск, что поднимется у вас «из коробки», будет явно недотягивать. И если очередь или базу данных вы можете добить железом прежде, чем будете оптимизировать, то поиск железом не добьешь.\u003Cbr\u002F\u003E\n\u003Cbr\u002F\u003E\nСуществую толстые книжки про настройки полнотекстового поиска, однако их мало кто читает. Сегодня я хотел бы на пальцах поговорить о том, что нужно учесть, когда вы делаете префиксный поиск с выводом результатов по мере набора слова или фразы. \u003Cbr\u002F\u003E\n\u003Cbr\u002F\u003E\nМы посмотрим, как с помощью нашего проекта \u003Ca href=\"http:\u002F\u002Findexisto.com\u002F\"\u003Ehttp:\u002F\u002Findexisto.com\u003C\u002Fa\u003E сделан поиск на сайте \u003Ca href=\"http:\u002F\u002Fmaximonline.ru\u002F\"\u003Ehttp:\u002F\u002Fmaximonline.ru\u003C\u002Fa\u003E и сравним его с тем, что есть на других сайтах.\u003Cbr\u002F\u003E\n\u003Cbr\u002F\u003E\nДля начала несколько примеров. Возьмем запрос \u003Cb\u003E«Битва за Лос Анджелес»\u003C\u002Fb\u003E и представим, что его напишут неправильно \u003Cb\u003E«Лос Анжелес биттва»\u003C\u002Fb\u003E. Как видно, пользователь не знает точно, как пишется имя города, и забыл, как звучит название фильма, а также у него дрогнула рука в конце на слове «битва».\u003Cbr\u002F\u003E\n\u003Cbr\u002F\u003E\nВыберем достойные проекты рунета, в которых есть префиксный поиск, и попробуем поискать там наш запрос:\u003Cbr\u002F\u003E\n\u003Cbr\u002F\u003E\n\u003Ctable\u003E\n\u003Ctr\u003E\n\u003Cth\u003EПроект\u003C\u002Fth\u003E\n\u003Cth\u003EПравильный запрос\u003C\u002Fth\u003E\n\u003Cth\u003EНеправильный запрос\u003C\u002Fth\u003E\n\u003C\u002Ftr\u003E\n\u003Ctr\u003E\n\u003Ctd\u003Eafisha.ru\u003Cbr\u002F\u003E\n\u003C\u002Ftd\u003E\n\u003Ctd\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fpost_images\u002F33e\u002Fc81\u002Fc7c\u002F33ec81c7cb6e6b66eb86b16c66d86cac.png\" sizes=\"(max-width: 780px) 100vw, 50vw\" srcset=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780\u002Fgetpro\u002Fhabr\u002Fpost_images\u002F33e\u002Fc81\u002Fc7c\u002F33ec81c7cb6e6b66eb86b16c66d86cac.png 780w,&#10; https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fpost_images\u002F33e\u002Fc81\u002Fc7c\u002F33ec81c7cb6e6b66eb86b16c66d86cac.png 781w\" loading=\"lazy\" decode=\"async\"\u002F\u003E\u003Cbr\u002F\u003E\n\u003Ci\u003Eвсе ОК\u003C\u002Fi\u003E\u003Cbr\u002F\u003E\n\u003C\u002Ftd\u003E\n\u003Ctd\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fpost_images\u002Fb45\u002F7e3\u002Fef0\u002Fb457e3ef074e9cf0de0f7980bbbd2c17.png\" sizes=\"(max-width: 780px) 100vw, 50vw\" srcset=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780\u002Fgetpro\u002Fhabr\u002Fpost_images\u002Fb45\u002F7e3\u002Fef0\u002Fb457e3ef074e9cf0de0f7980bbbd2c17.png 780w,&#10; https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fpost_images\u002Fb45\u002F7e3\u002Fef0\u002Fb457e3ef074e9cf0de0f7980bbbd2c17.png 781w\" loading=\"lazy\" decode=\"async\"\u002F\u003E\u003Cbr\u002F\u003E\n\u003Ci\u003EНе найдено\u003C\u002Fi\u003E\u003Cbr\u002F\u003E\n\u003C\u002Ftd\u003E\n\u003C\u002Ftr\u003E\n\u003Ctr\u003E\n\u003Ctd\u003Eivi.ru\u003Cbr\u002F\u003E\n\u003C\u002Ftd\u003E\n\u003Ctd\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fpost_images\u002Fa45\u002F86d\u002F492\u002Fa4586d49296f2a7793881a3d2d2ee485.png\" sizes=\"(max-width: 780px) 100vw, 50vw\" srcset=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780\u002Fgetpro\u002Fhabr\u002Fpost_images\u002Fa45\u002F86d\u002F492\u002Fa4586d49296f2a7793881a3d2d2ee485.png 780w,&#10; https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fpost_images\u002Fa45\u002F86d\u002F492\u002Fa4586d49296f2a7793881a3d2d2ee485.png 781w\" loading=\"lazy\" decode=\"async\"\u002F\u003E\u003Cbr\u002F\u003E\n\u003Ci\u003Eвсе ОК\u003C\u002Fi\u003E\u003Cbr\u002F\u003E\n\u003C\u002Ftd\u003E\n\u003Ctd\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fpost_images\u002Fc51\u002F426\u002F84b\u002Fc5142684bd7e03b39bbec4495be210d8.png\" sizes=\"(max-width: 780px) 100vw, 50vw\" srcset=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780\u002Fgetpro\u002Fhabr\u002Fpost_images\u002Fc51\u002F426\u002F84b\u002Fc5142684bd7e03b39bbec4495be210d8.png 780w,&#10; https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fpost_images\u002Fc51\u002F426\u002F84b\u002Fc5142684bd7e03b39bbec4495be210d8.png 781w\" loading=\"lazy\" decode=\"async\"\u002F\u003E\u003Cbr\u002F\u003E\n\u003Ci\u003EНе найдено\u003C\u002Fi\u003E\u003Cbr\u002F\u003E\n\u003C\u002Ftd\u003E\n\u003C\u002Ftr\u003E\n\u003Ctr\u003E\n\u003Ctd\u003Evk.com\u003Cbr\u002F\u003E\n\u003C\u002Ftd\u003E\n\u003Ctd\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fpost_images\u002F58c\u002F729\u002F7ec\u002F58c7297ec5daa02f037d9047c6c455d0.png\" sizes=\"(max-width: 780px) 100vw, 50vw\" srcset=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780\u002Fgetpro\u002Fhabr\u002Fpost_images\u002F58c\u002F729\u002F7ec\u002F58c7297ec5daa02f037d9047c6c455d0.png 780w,&#10; https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fpost_images\u002F58c\u002F729\u002F7ec\u002F58c7297ec5daa02f037d9047c6c455d0.png 781w\" loading=\"lazy\" decode=\"async\"\u002F\u003E\u003Cbr\u002F\u003E\n\u003Ci\u003Eвсе ОК\u003C\u002Fi\u003E\u003Cbr\u002F\u003E\n\u003C\u002Ftd\u003E\n\u003Ctd\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fpost_images\u002Fcf2\u002F715\u002Ff39\u002Fcf2715f39df2a0f74ea85ccd5aa2ef5a.png\" sizes=\"(max-width: 780px) 100vw, 50vw\" srcset=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780\u002Fgetpro\u002Fhabr\u002Fpost_images\u002Fcf2\u002F715\u002Ff39\u002Fcf2715f39df2a0f74ea85ccd5aa2ef5a.png 780w,&#10; https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fpost_images\u002Fcf2\u002F715\u002Ff39\u002Fcf2715f39df2a0f74ea85ccd5aa2ef5a.png 781w\" loading=\"lazy\" decode=\"async\"\u002F\u003E\u003Cbr\u002F\u003E\n\u003Ci\u003EНе найдено\u003C\u002Fi\u003E\u003Cbr\u002F\u003E\n\u003C\u002Ftd\u003E\n\u003C\u002Ftr\u003E\n\u003Ctr\u003E\n\u003Ctd\u003Emaximonline.ru\u003Cbr\u002F\u003E\n\u003C\u002Ftd\u003E\n\u003Ctd\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fpost_images\u002F20f\u002F9e3\u002F38a\u002F20f9e338aaebab27e3404f219b422d52.png\" sizes=\"(max-width: 780px) 100vw, 50vw\" srcset=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780\u002Fgetpro\u002Fhabr\u002Fpost_images\u002F20f\u002F9e3\u002F38a\u002F20f9e338aaebab27e3404f219b422d52.png 780w,&#10; https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fpost_images\u002F20f\u002F9e3\u002F38a\u002F20f9e338aaebab27e3404f219b422d52.png 781w\" loading=\"lazy\" decode=\"async\"\u002F\u003E\u003Cbr\u002F\u003E\n\u003Ci\u003Eвсе ОК\u003C\u002Fi\u003E\u003Cbr\u002F\u003E\n\u003C\u002Ftd\u003E\n\u003Ctd\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fpost_images\u002F327\u002F6ad\u002Fb90\u002F3276adb902950ba3b1fba84dcd640099.png\" sizes=\"(max-width: 780px) 100vw, 50vw\" srcset=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780\u002Fgetpro\u002Fhabr\u002Fpost_images\u002F327\u002F6ad\u002Fb90\u002F3276adb902950ba3b1fba84dcd640099.png 780w,&#10; https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fpost_images\u002F327\u002F6ad\u002Fb90\u002F3276adb902950ba3b1fba84dcd640099.png 781w\" loading=\"lazy\" decode=\"async\"\u002F\u003E\u003Cbr\u002F\u003E\n\u003Ci\u003Eвсе ОК\u003C\u002Fi\u003E\u003Cbr\u002F\u003E\n\u003C\u002Ftd\u003E\n\u003C\u002Ftr\u003E\n\u003C\u002Ftable\u003E\u003Cbr\u002F\u003E\n\u003Ca name=\"habracut\"\u003E\u003C\u002Fa\u003E\u003Cbr\u002F\u003E\nКак видно из нашего небольшого исследования, ситуация далека от идеальной. Вот типичные проблемы\u003Cbr\u002F\u003E\n\u003Cul\u003E\n\u003Cli\u003EНе работает перестановка слов\u003C\u002Fli\u003E\n\u003Cli\u003EНаблюдаются «скачки». То есть по мере набора искомый фильм то появляется в результатах, то пропадает.\u003C\u002Fli\u003E\n\u003Cli\u003EОтсутствие нечеткого поиска\u003C\u002Fli\u003E\n\u003Cli\u003EНе у всех есть морфология\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\u003Cbr\u002F\u003E\n\u003Cbr\u002F\u003E\n\u003Ch4\u003EПоехали настраивать\u003C\u002Fh4\u003E\u003Cbr\u002F\u003E\nВ статье речь будет идти о сервере ElasticSearch, однако эти же подходы можно использовать и при настройке SOLR, так как в итоге все высокоуровневые запросы все равно мапятся на запросы более низкоруровневой библиотеки поиска Lucene. Также не принципиально, делаете ли вы префиксный поиск с помощью \u003Ca href=\"http:\u002F\u002Fen.wikipedia.org\u002Fwiki\u002FN-gram\"\u003Engram токенизаторов\u003C\u002Fa\u003E или с помощью префиксных запросов (довольно тяжеловесных, так как они мапятся на fuzzy-запросы).\u003Cbr\u002F\u003E\n\u003Cbr\u002F\u003E\n\u003Ch4\u003EИндексация\u003C\u002Fh4\u003E\u003Cbr\u002F\u003E\nПри индексации текст проходит через токенизатор и ряд фильтров (морфология, синонимы...). Оригинальное слово в итоге может быть заменено, приведено к нормальной форме или вообще выкинуто. Через какие бы фильтры вы ни прогоняли ваши токены, сохраняйте оригинальное слово в той же позиции, что и измененное\u002Fзамененное. Что может случиться, если не сохранить оригинальное слово, показанно на картинке:\u003Cbr\u002F\u003E\n\u003Cbr\u002F\u003E\n\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fpost_images\u002Fec7\u002Fcc2\u002F273\u002Fec7cc2273c63a5b540ecd3896b3ebc59.png\" sizes=\"(max-width: 780px) 100vw, 50vw\" srcset=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780\u002Fgetpro\u002Fhabr\u002Fpost_images\u002Fec7\u002Fcc2\u002F273\u002Fec7cc2273c63a5b540ecd3896b3ebc59.png 780w,&#10; https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fpost_images\u002Fec7\u002Fcc2\u002F273\u002Fec7cc2273c63a5b540ecd3896b3ebc59.png 781w\" loading=\"lazy\" decode=\"async\"\u002F\u003E\u003Cbr\u002F\u003E\n\u003Cbr\u002F\u003E\nКак видите, фильтр морфологии меняет слово (приводит к нормальной форме). В обычном поиске это работает хорошо, так как слово из запроса, который ввел пользователь, тоже будет приведено к нормальной форме. Но что делать, пока пользователь ввел только половину слова (префиксный поиск)? Сохраняем оригинальный токен в индексе!\u003Cbr\u002F\u003E\n\u003Cbr\u002F\u003E\n\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fpost_images\u002F209\u002F1c5\u002Fe05\u002F2091c5e05c76dd161e5daff1a2085d38.png\" sizes=\"(max-width: 780px) 100vw, 50vw\" srcset=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780\u002Fgetpro\u002Fhabr\u002Fpost_images\u002F209\u002F1c5\u002Fe05\u002F2091c5e05c76dd161e5daff1a2085d38.png 780w,&#10; https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fpost_images\u002F209\u002F1c5\u002Fe05\u002F2091c5e05c76dd161e5daff1a2085d38.png 781w\" loading=\"lazy\" decode=\"async\"\u002F\u003E\u003Cbr\u002F\u003E\n\u003Cbr\u002F\u003E\nУ нас, кстати, возникли проблемы в стандартных плагинах Lucene, и мы сделали свои, которые лучше работают с позициями токенов в документе и сохранением оригинального слова. О том, какие проблемы вас могут поджидать, можно почитать, например, здесь: \u003Ca href=\"http:\u002F\u002Fblog.mikemccandless.com\u002F2012\u002F04\u002Flucenes-tokenstreams-are-actually.html\"\u003ELucene's TokenStreams are actually graphs! \u003C\u002Fa\u003E\u003Cbr\u002F\u003E\n\u003Cbr\u002F\u003E\n\u003Ch4\u003EАнализаторы запроса \u003C\u002Fh4\u003E\u003Cbr\u002F\u003E\nНе используйте анализаторы, которые могут вам «подчистить» запрос, например, фильтр стоп-слов, который удаляет междометия и частицы. Вот пример:\u003Cbr\u002F\u003E\n\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fpost_images\u002F95c\u002Fe86\u002F603\u002F95ce8660329d8c8fb5cf09fdaf2ea85e.png\" sizes=\"(max-width: 780px) 100vw, 50vw\" srcset=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780\u002Fgetpro\u002Fhabr\u002Fpost_images\u002F95c\u002Fe86\u002F603\u002F95ce8660329d8c8fb5cf09fdaf2ea85e.png 780w,&#10; https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fpost_images\u002F95c\u002Fe86\u002F603\u002F95ce8660329d8c8fb5cf09fdaf2ea85e.png 781w\" loading=\"lazy\" decode=\"async\"\u002F\u003E\u003Cbr\u002F\u003E\n\u003Cbr\u002F\u003E\nКак видите, «а» это стоп-слово, и анализатор запроса ее удалил. На практике это означает, что будет «скачок», то есть человек набрал «Хаунита А» и видит документ по запросу Хуанита (без А). Если у нас много Хуанит в выдаче, то нет никакой гарантии, что нужная нам будет сверху.\u003Cbr\u002F\u003E\nДля того, чтобы это побороть, убираем фильтр стоп-слов из запроса:\u003Cbr\u002F\u003E\n\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fpost_images\u002F87b\u002F950\u002Fe62\u002F87b950e626f1d46e834e09e7c7e37aca.png\" sizes=\"(max-width: 780px) 100vw, 50vw\" srcset=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780\u002Fgetpro\u002Fhabr\u002Fpost_images\u002F87b\u002F950\u002Fe62\u002F87b950e626f1d46e834e09e7c7e37aca.png 780w,&#10; https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fpost_images\u002F87b\u002F950\u002Fe62\u002F87b950e626f1d46e834e09e7c7e37aca.png 781w\" loading=\"lazy\" decode=\"async\"\u002F\u003E\u003Cbr\u002F\u003E\n\u003Cbr\u002F\u003E\n\u003Ch4\u003EЗапрос\u003C\u002Fh4\u003E\u003Cbr\u002F\u003E\nНе пытайтесь сделать все сразу одним путанным гигантским запросом. Разбейте задачу на подзадачи. Существуют булевы и dismax-запросы, которые помогут вам склеить результаты работы нескольких мелких запросов в один. Используйте boost в небольших запросах, чтобы, к примеру, увеличить вес точного совпадения в title страницы по сравнению с совпадением в body страницы. Примерно вот так:\u003Cbr\u002F\u003E\n\u003Cpre\u003E\u003Ccode class=\"javascript\"\u003E{\n \"query\":{\n \"bool\" : {\n \"should\" : [\n {\n \"custom_boost_factor\": {\n \"query\":{\n \"match\":{\n ....\n }\n },\n \"boost_factor\": 100\n }\n },\n {\n \"custom_boost_factor\": {\n \"query\":{\n \"match\":{\n ....\n }\n }\n },\n \"boost_factor\": 10\n }\n },\n .....\n ]\n }\n }\n}\n\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\n\u003Cbr\u002F\u003E\n\u003Ch4\u003EТочное совпадение фразы в заголовке статьи\u003C\u002Fh4\u003E\u003Cbr\u002F\u003E\nИтак, наш поисковый запрос состоит из кучки маленьких запросов с разными boost-факторами. Boost-фактор — это множитель релевантности, который применяется, когда базовая текстовая релевантность уже посчитана.\u003Cbr\u002F\u003E\n\u003Cbr\u002F\u003E\nСначала у нас идет поиск на точное совпадение фразы в заголовке статьи (или title страницы). Точное совпадение означает, что мы не используем префикс. Например, запрос \u003Cb\u003E«КАК»\u003C\u002Fb\u003E выведет первыми статьи \u003Ci\u003E«\u003Cb\u003EКак\u003C\u002Fb\u003E правильно…»\u003C\u002Fi\u003E, а не статью \u003Ci\u003E«Выращиваем \u003Cb\u003Eкак\u003C\u002Fb\u003Eтус»\u003C\u002Fi\u003E. Документы, найденные по такому запросу, получают буст, к примеру, 10000.\u003Cbr\u002F\u003E\n\u003Cbr\u002F\u003E\n\u003Ch4\u003EПрефиксное совпадение фразы в заголовке статьи\u003C\u002Fh4\u003E\u003Cbr\u002F\u003E\nДалее идет запрос на префиксное совпадние фарзы. Точные совпадения слова «КАК» нам уже нашел первый запрос, теперь время поискать \u003Ci\u003E«\u003Cb\u003Eкак\u003C\u002Fb\u003Eтусы»\u003C\u002Fi\u003E. Эти документы будут идти ниже точных совпадений за счет меньшего буста.\u003Cbr\u002F\u003E\nМы также здесь используем параметр slop, который говорит, что слова в фразе могут отстоять друг от друга на несколько позиций вперед или назад. Многие забывают про этот параметр, а по умолчанию префиксный поиск ищет только вперед.\u003Cbr\u002F\u003E\n\u003Cbr\u002F\u003E\nВот какая выдача получается на текущий момент:\u003Cbr\u002F\u003E\n\u003Cbr\u002F\u003E\n\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fpost_images\u002F0c0\u002Fd41\u002F234\u002F0c0d412340dd1c2810d4f17da7e16e40.png\" sizes=\"(max-width: 780px) 100vw, 50vw\" srcset=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780\u002Fgetpro\u002Fhabr\u002Fpost_images\u002F0c0\u002Fd41\u002F234\u002F0c0d412340dd1c2810d4f17da7e16e40.png 780w,&#10; https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fpost_images\u002F0c0\u002Fd41\u002F234\u002F0c0d412340dd1c2810d4f17da7e16e40.png 781w\" loading=\"lazy\" decode=\"async\"\u002F\u003E\u003Cbr\u002F\u003E\n\u003Cbr\u002F\u003E\nПервыми идут точные совпадения, вторыми — префиксные.\u003Cbr\u002F\u003E\n\u003Cbr\u002F\u003E\n\u003Ch4\u003EСовпадения в теле статьи — полное и префиксное\u003C\u002Fh4\u003E\u003Cbr\u002F\u003E\nСовпадения в заголовке мы нашли и сделали им приличный буст. Время перейти к самому телу статьи. В первую очередь мы опять ищем точное совпадение, и с меньшим boost-фактором префиксные совпадения. \u003Cbr\u002F\u003E\n\u003Cbr\u002F\u003E\nТаким образом, совпадения в заголовке будут первыми в выдаче, а совпадения в теле статьи — ниже. Встает вопрос: не отдать ли подобную сортировку на откуп текстовой релевантности? Ведь стандартные алгоритмы учитывают длину текста, в котором найдено совпадение: чем короче текст, тем выше релевантность. Однако практика показала, что при префиксном поиске в теле статьи будет очень много совпадений. Представьте, вы набрали 1-2 буквы, а в теле статьи будет уже 200-300 совпадений, и, несмотря на длину текста, они перебьют релевантность совпадений в заголовке.\u003Cbr\u002F\u003E\n\u003Cbr\u002F\u003E\n\u003Ch4\u003EНечеткие совпадения в заголовке или теле статьи\u003C\u002Fh4\u003E\u003Cbr\u002F\u003E\nПоследним (за счет буста) идет нечеткий поиск. Нечеткий поиск прощает некоторые опечатки в поисковом запросе, введенном пользователем. Внутри запроса используется \u003Ca href=\"http:\u002F\u002Fen.wikipedia.org\u002Fwiki\u002FLevenshtein_distance\"\u003ELevenshtein distance\u003C\u002Fa\u003E. Нечеткий запрос имеет несколько настроек, которые выступают в качестве параметров к алгоритму, а также есть возможность указать минимальное необходимое совпадение префикса. \u003Cbr\u002F\u003E\n\u003Cpre\u003E\u003Ccode class=\"javascript\"\u003E\"custom_boost_factor\": {\n \"query\":{\n \"multi_match\":{\n \"query\":\"${q}\",\n \"fuzziness\":0.005,\n \"prefix_length\" : 2,\n \"operator\":\"and\",\n \"max_expansions\":999,\n \"fields\":[\n \"article_name\",\n \"article_body\"\n ]\n }\n },\n \"boost_factor\": 1\n }\n }\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\nСовпадения, найденные нечетким поиском, идут в самом низу за счет минимального boost-фактора.\u003Cbr\u002F\u003E\n\u003Cbr\u002F\u003E\n\u003Ch4\u003EЧто в итоге\u003C\u002Fh4\u003E\u003Cbr\u002F\u003E\nНа картинке видно, как выстроились наши результаты в зависимости от совпадений:\u003Cbr\u002F\u003E\n\u003Cul\u003E\n\u003Cli\u003Eв заголовке точные\u003C\u002Fli\u003E\n\u003Cli\u003Eв заголовке по префиксу\u003C\u002Fli\u003E\n\u003Cli\u003Eв теле статьи точные\u003C\u002Fli\u003E\n\u003Cli\u003Eв теле статьи по префиксу\u003C\u002Fli\u003E\n\u003Cli\u003Eв заголовке и теле статьи нечеткие (с опечатками)\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\u003Cbr\u002F\u003E\n\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fpost_images\u002F275\u002F1ee\u002F2ee\u002F2751ee2eecba1e3e8bdd2d75d28b74ba.png\" sizes=\"(max-width: 780px) 100vw, 50vw\" srcset=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780\u002Fgetpro\u002Fhabr\u002Fpost_images\u002F275\u002F1ee\u002F2ee\u002F2751ee2eecba1e3e8bdd2d75d28b74ba.png 780w,&#10; https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fpost_images\u002F275\u002F1ee\u002F2ee\u002F2751ee2eecba1e3e8bdd2d75d28b74ba.png 781w\" loading=\"lazy\" decode=\"async\"\u002F\u003E\u003Cbr\u002F\u003E\n\u003Cbr\u002F\u003E\n\u003Ch4\u003EБонус-трек для тех, кто осилил статью\u003C\u002Fh4\u003E\u003Cbr\u002F\u003E\nМы собираем всю статистику поисковых запросов, клики по результатам выдачи, поиски без переходов, поиски с пустым результатом. \u003Cbr\u002F\u003E\nИнтересно, что на \u003Ca href=\"http:\u002F\u002Fwww.maximonline.ru\u002F\"\u003Emaximonline.ru\u003C\u002Fa\u003E поиск довольно востребованный функционал, а 90% поисковых запросов это имена девушек. Здесь можно получить очень интересные данные :)\u003Cbr\u002F\u003E\n\u003Cbr\u002F\u003E\nИтак, самые искомые читателями Maxim девушки в обратном порядке! Данные за ноябрь 2013.\u003Cbr\u002F\u003E\n\u003Cbr\u002F\u003E\n5. Анна Семенович (телеведущая)\u003Cbr\u002F\u003E\n\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fpost_images\u002F8e9\u002F090\u002Fdb8\u002F8e9090db8e9b1b2b4b9ef500efc60fec.jpg\" sizes=\"(max-width: 780px) 100vw, 50vw\" srcset=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780\u002Fgetpro\u002Fhabr\u002Fpost_images\u002F8e9\u002F090\u002Fdb8\u002F8e9090db8e9b1b2b4b9ef500efc60fec.jpg 780w,&#10; https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fpost_images\u002F8e9\u002F090\u002Fdb8\u002F8e9090db8e9b1b2b4b9ef500efc60fec.jpg 781w\" loading=\"lazy\" decode=\"async\"\u002F\u003E\u003Cbr\u002F\u003E\n\u003Cbr\u002F\u003E\n4. Вера Брежнева (певица)\u003Cbr\u002F\u003E\n\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fpost_images\u002Fa20\u002F0e2\u002Ffd8\u002Fa200e2fd88969cb14397dc0a329cc3ca.jpg\" sizes=\"(max-width: 780px) 100vw, 50vw\" srcset=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780\u002Fgetpro\u002Fhabr\u002Fpost_images\u002Fa20\u002F0e2\u002Ffd8\u002Fa200e2fd88969cb14397dc0a329cc3ca.jpg 780w,&#10; https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fpost_images\u002Fa20\u002F0e2\u002Ffd8\u002Fa200e2fd88969cb14397dc0a329cc3ca.jpg 781w\" loading=\"lazy\" decode=\"async\"\u002F\u003E\u003Cbr\u002F\u003E\n\u003Cbr\u002F\u003E\n3. Анна Хилькевич (актриса)\u003Cbr\u002F\u003E\n\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fpost_images\u002F6e7\u002Fd86\u002F304\u002F6e7d8630478703421023ccc9f68756dd.jpg\" sizes=\"(max-width: 780px) 100vw, 50vw\" srcset=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780\u002Fgetpro\u002Fhabr\u002Fpost_images\u002F6e7\u002Fd86\u002F304\u002F6e7d8630478703421023ccc9f68756dd.jpg 780w,&#10; https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fpost_images\u002F6e7\u002Fd86\u002F304\u002F6e7d8630478703421023ccc9f68756dd.jpg 781w\" loading=\"lazy\" decode=\"async\"\u002F\u003E\u003Cbr\u002F\u003E\n\u003Cbr\u002F\u003E\n2. Мария Горбань (актриса)\u003Cbr\u002F\u003E\n\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fpost_images\u002F289\u002Fc6e\u002F60c\u002F289c6e60c61a3a35a2e5651bf254858b.jpg\" sizes=\"(max-width: 780px) 100vw, 50vw\" srcset=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780\u002Fgetpro\u002Fhabr\u002Fpost_images\u002F289\u002Fc6e\u002F60c\u002F289c6e60c61a3a35a2e5651bf254858b.jpg 780w,&#10; https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fpost_images\u002F289\u002Fc6e\u002F60c\u002F289c6e60c61a3a35a2e5651bf254858b.jpg 781w\" loading=\"lazy\" decode=\"async\"\u002F\u003E\u003Cbr\u002F\u003E\n\u003Cbr\u002F\u003E\n1. Екатерина Волкова (актриса)\u003Cbr\u002F\u003E\n\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fpost_images\u002Fa1c\u002F0ab\u002Fde4\u002Fa1c0abde43edad735842eec9a892c923.jpg\" sizes=\"(max-width: 780px) 100vw, 50vw\" srcset=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780\u002Fgetpro\u002Fhabr\u002Fpost_images\u002Fa1c\u002F0ab\u002Fde4\u002Fa1c0abde43edad735842eec9a892c923.jpg 780w,&#10; https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fpost_images\u002Fa1c\u002F0ab\u002Fde4\u002Fa1c0abde43edad735842eec9a892c923.jpg 781w\" loading=\"lazy\" decode=\"async\"\u002F\u003E\u003C\u002Fdiv\u003E","tags":[{"titleHtml":"elasticsearch"},{"titleHtml":"поисковые системы"},{"titleHtml":"поиск по сайту"},{"titleHtml":"lucene"}],"metadata":{"stylesUrls":[],"scriptUrls":[],"shareImageUrl":"https:\u002F\u002Fhabr.com\u002Fshare\u002Fpublication\u002F204654\u002F832f3895b33a9c5654aed011499709c4\u002F","shareImageWidth":1200,"shareImageHeight":630,"vkShareImageUrl":"https:\u002F\u002Fhabr.com\u002Fshare\u002Fpublication\u002F204654\u002F832f3895b33a9c5654aed011499709c4\u002F?format=vk","schemaJsonLd":"{\"@context\":\"http:\\\u002F\\\u002Fschema.org\",\"@type\":\"Article\",\"mainEntityOfPage\":{\"@type\":\"WebPage\",\"@id\":\"https:\\\u002F\\\u002Fhabr.com\\\u002Fru\\\u002Fcompanies\\\u002Fvk\\\u002Farticles\\\u002F204654\\\u002F\"},\"headline\":\"Как это сделано: префиксный поиск\",\"datePublished\":\"2013-12-03T13:48:07+04:00\",\"dateModified\":\"2013-12-03T13:48:58+04:00\",\"author\":{\"@type\":\"Person\",\"name\":\"Cher\"},\"publisher\":{\"@type\":\"Organization\",\"name\":\"Habr\",\"logo\":{\"@type\":\"ImageObject\",\"url\":\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fa_\\\u002Flk\\\u002F9m\\\u002Fa_lk9mjkccjox-zccjrpfolmkmq.png\"}},\"description\":\"Мы живем во времена, когда кажется, что все просто и все есть. Нужно сделать масштабируемый проект &mdash; используем MongoDB, нужна очередь &mdash; вот RabbitMQ, нужно подн...\",\"url\":\"https:\\\u002F\\\u002Fhabr.com\\\u002Fru\\\u002Fcompanies\\\u002Fvk\\\u002Farticles\\\u002F204654\\\u002F#post-content-body\",\"about\":[\"c_vk\",\"h_webdev\",\"h_search_technologies\",\"f_develop\"],\"image\":[\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fpost_images\\\u002F33e\\\u002Fc81\\\u002Fc7c\\\u002F33ec81c7cb6e6b66eb86b16c66d86cac.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fpost_images\\\u002Fb45\\\u002F7e3\\\u002Fef0\\\u002Fb457e3ef074e9cf0de0f7980bbbd2c17.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fpost_images\\\u002Fa45\\\u002F86d\\\u002F492\\\u002Fa4586d49296f2a7793881a3d2d2ee485.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fpost_images\\\u002Fc51\\\u002F426\\\u002F84b\\\u002Fc5142684bd7e03b39bbec4495be210d8.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fpost_images\\\u002F58c\\\u002F729\\\u002F7ec\\\u002F58c7297ec5daa02f037d9047c6c455d0.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fpost_images\\\u002Fcf2\\\u002F715\\\u002Ff39\\\u002Fcf2715f39df2a0f74ea85ccd5aa2ef5a.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fpost_images\\\u002F20f\\\u002F9e3\\\u002F38a\\\u002F20f9e338aaebab27e3404f219b422d52.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fpost_images\\\u002F327\\\u002F6ad\\\u002Fb90\\\u002F3276adb902950ba3b1fba84dcd640099.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fpost_images\\\u002Fec7\\\u002Fcc2\\\u002F273\\\u002Fec7cc2273c63a5b540ecd3896b3ebc59.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fpost_images\\\u002F209\\\u002F1c5\\\u002Fe05\\\u002F2091c5e05c76dd161e5daff1a2085d38.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fpost_images\\\u002F95c\\\u002Fe86\\\u002F603\\\u002F95ce8660329d8c8fb5cf09fdaf2ea85e.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fpost_images\\\u002F87b\\\u002F950\\\u002Fe62\\\u002F87b950e626f1d46e834e09e7c7e37aca.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fpost_images\\\u002F0c0\\\u002Fd41\\\u002F234\\\u002F0c0d412340dd1c2810d4f17da7e16e40.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fpost_images\\\u002F275\\\u002F1ee\\\u002F2ee\\\u002F2751ee2eecba1e3e8bdd2d75d28b74ba.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fpost_images\\\u002F8e9\\\u002F090\\\u002Fdb8\\\u002F8e9090db8e9b1b2b4b9ef500efc60fec.jpg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fpost_images\\\u002Fa20\\\u002F0e2\\\u002Ffd8\\\u002Fa200e2fd88969cb14397dc0a329cc3ca.jpg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fpost_images\\\u002F6e7\\\u002Fd86\\\u002F304\\\u002F6e7d8630478703421023ccc9f68756dd.jpg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fpost_images\\\u002F289\\\u002Fc6e\\\u002F60c\\\u002F289c6e60c61a3a35a2e5651bf254858b.jpg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fpost_images\\\u002Fa1c\\\u002F0ab\\\u002Fde4\\\u002Fa1c0abde43edad735842eec9a892c923.jpg\"]}","metaDescription":"Мы живем во времена, когда кажется, что все просто и все есть. Нужно сделать масштабируемый проект — используем MongoDB, нужна очередь — вот RabbitMQ, нужно поднять функционал поиска — раз плюнуть:...","mainImageUrl":null,"amp":false,"customTrackerLinks":[]},"polls":[],"commentsEnabled":{"status":true,"reason":null},"rulesRemindEnabled":false,"votesEnabled":true,"status":"published","plannedPublishTime":null,"checked":null,"hasPinnedComments":false,"format":null,"banner":null,"multiwidget":null,"multiwidgetUuid":null,"readingTime":5,"complexity":null,"isEditorial":false,"allowedFeatures":{"isTestTargetAllow":false}}},"articlesIds":{},"isLoading":false,"pagesCount":{},"route":{},"reasonsList":null,"postReasonsList":null,"view":"cards","lastVisitedRoute":{},"ssrCommentsArticleIds":[""],"viewedPosts":[],"myFeedFilter":{"complexity":"all","score":"all","types":["articles","posts","news"]},"myFeedIsApplyFilters":false,"myFeedIsForce":false,"karma":{"userReasonsList":null}},"authorContribution":{"authors":{}},"betaTest":{"currentAnnouncement":null,"announcements":{},"announcementCards":null,"announcementComments":{},"announcementCommentThreads":{},"announcementCommentingStatuses":{},"archivedList":[]},"authorStatistics":{"articleRefs":{},"articleIds":{},"pagesCount":{},"route":{},"viewsCount":[],"maxStatsCount":{}},"career":{"seoLandings":[],"hubs":""},"comments":{"articleComments":{},"articlePinnedComments":{},"searchCommentsResults":null,"pagesCount":null,"commentAccess":{},"scrollParents":{},"pageArticleComments":{"lastViewedComment":0,"postId":null,"lastCommentTimestamp":"","moderated":[],"moderatedIds":[],"commentRoute":"","idempotenceKey":""}},"companies":{"companyRefs":{"vk":{"alias":"vk","imageUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fcompany\u002F4b6\u002Fb3a\u002F7f0\u002F4b6b3a7f070b96467c0b0f15c3159fa8.png","titleHtml":"VK","descriptionHtml":"Building the Internet","relatedData":null,"statistics":{"subscribersCount":236432,"rating":728.35,"invest":null,"postsCount":53,"threadsCount":0,"newsCount":1,"vacanciesCount":6,"employeesCount":727,"careerRating":null},"foundationDate":{"year":"1998","month":"10","day":"15"},"location":{"city":{"id":"447159","title":"Москва"},"region":{"id":"1885","title":"Москва и Московская обл."},"country":{"id":"168","title":"Россия"}},"siteUrl":"https:\u002F\u002Fvk.com\u002Fvkteam","staffNumber":"5,001–10,000 employees","registrationDate":"2008-08-09T07:42:32+00:00","representativeUser":{"alias":"somuchmich","fullname":"Миша Берггрен"},"contacts":[],"settings":{"analyticsSettings":[{"type":"ga","trackingId":"UA-16546458-6"},{"type":"ym","trackingId":"99776065"}],"branding":{"imageUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fbranding\u002F16a\u002F30d\u002Faa7\u002F16a30daa7609ae0eba4a1a96926e3fca.png","linkUrl":"https:\u002F\u002Fvk.com\u002Fvkteam","pixelUrl":null,"uuid":"0191e176-5a3e-712c-bb73-50a48e8bef14"},"status":"active","isStartup":false,"hasActivePolls":false,"shouldShowHabrAds":false},"metadata":{"titleHtml":"VK, Москва - Building the Internet since October 15, 1998","title":"VK, Москва - Building the Internet since October 15, 1998","keywords":[],"descriptionHtml":"53 articles from VK company authors","description":"53 articles from VK company authors"},"aDeskSettings":null,"careerAlias":"vk","schoolAlias":null}},"companyIds":{},"companyTopIds":{},"pagesCount":{},"companyProfiles":{},"companiesCategories":[],"companiesCategoriesTotalCount":0,"companiesWidgets":{},"companiesWorkers":{},"companiesFans":{},"multiwidgets":{},"route":{},"isLoading":false,"companyWorkersLoading":false,"companyFansLoading":false,"multiwidgetLoading":false,"vacancies":{},"companiesGalleries":{},"companiesBanners":{},"companiesLandingVacancies":{},"companiesTechnologies":{},"workplaceInfo":null},"companyAdmin":{"companyInfo":null,"companyInfoLoading":false,"faqArticles":null,"brandingPreviewImageUrl":null,"jivoStatus":0,"adminNotifications":null,"availableInvitesCount":{}},"companyAdd":{"currentStep":"","stepsData":{},"uncompletedSteps":[],"isStepLoading":true,"isStepCommitting":false,"isInitialized":false,"agreementContent":""},"companiesContribution":{"hubs":{},"flows":{},"companyRefs":{}},"companyHubsContribution":{"contributionRefs":{"hubRefs":{},"hubIds":{}}},"conversation":{"messages":[],"respondent":null,"isLoadMore":false},"conversations":{"conversations":[],"pagesCount":0},"docs":{"menu":{},"articles":{},"mainMenu":[],"loading":{"main":false,"dropdown":false,"article":false}},"feature":{"isProbablyVisible":true},"fixedBanner":{"isArticleStickyPanelVisible":false,"isArticleStickyPanelAtTheBottom":false,"isFixedBannerVisible":false,"isStickyPanelIconsHidden":false},"flows":{"flows":[{"id":"1","alias":"develop","title":"Development","titleHtml":"Development","route":{"name":"FLOW_PAGE","params":{"flowName":"develop","hl":"en"}}},{"id":"6","alias":"admin","title":"Administrating","titleHtml":"Administrating","route":{"name":"FLOW_PAGE","params":{"flowName":"admin","hl":"en"}}},{"id":"2","alias":"design","title":"Design","titleHtml":"Design","route":{"name":"FLOW_PAGE","params":{"flowName":"design","hl":"en"}}},{"id":"3","alias":"management","title":"Management","titleHtml":"Management","route":{"name":"FLOW_PAGE","params":{"flowName":"management","hl":"en"}}},{"id":"4","alias":"marketing","title":"Marketing","titleHtml":"Marketing","route":{"name":"FLOW_PAGE","params":{"flowName":"marketing","hl":"en"}}},{"id":"7","alias":"popsci","title":"PopSci","titleHtml":"PopSci","route":{"name":"FLOW_PAGE","params":{"flowName":"popsci","hl":"en"}}}],"updates":{}},"global":{"isPwa":false,"device":"desktop","isHabrCom":true,"requestId":"9c74a4b9afde7d50f9f401351469803e"},"hubs":{"hubRefs":{},"hubIds":{},"pagesCount":{},"isLoading":false,"route":{}},"hubsBlock":{"hubRefs":{},"hubIds":{}},"i18n":{"fl":"en","hl":"en"},"info":{"welcomePage":{},"isLoading":true},"location":{"urlStruct":{"protocol":null,"slashes":null,"auth":null,"host":null,"port":null,"hostname":null,"hash":null,"query":{},"pathname":"\u002Fen\u002Fcompanies\u002Fvk\u002Farticles\u002F204654\u002F","path":"\u002Fen\u002Fcompanies\u002Fvk\u002Farticles\u002F204654\u002F","href":"\u002Fen\u002Fcompanies\u002Fvk\u002Farticles\u002F204654\u002F"}},"me":{"user":null,"uuid":null,"ppgDemanded":false,"karmaResetInfo":{"canReincarnate":null,"wasReincarnated":null,"currentScore":null},"notes":null,"userUpdates":{"feeds":{"newPostsCount":null,"newThreadsCount":null,"newNewsCount":null,"newCount":null},"conversationUnreadCount":0},"features":null},"mostReadingList":{"mostReadingListIds":[],"mostReadingListRefs":null,"promoPost":null},"onboarding":{"currentStep":null,"stepsData":{},"stepsErrors":{},"completedSteps":[],"isStepCommitting":false,"isCommitDisabled":true},"ppa":{"articles":{},"card":null,"transactions":null,"totalTransactions":null,"isAccessible":null},"projectsBlocks":{"activeBlocks":{"vacancies":"project-block-company-article"}},"promoData":{"isLoading":false,"hasLoaded":false,"featurer":null,"megaposts":null,"promoLinks":null,"promoPosts":null,"sticker":null},"publicationStatistics":{"statsInfo":{},"statsFunnels":{},"statsGraph":{},"defaultSuggest":{},"suggest":{},"timeTracker":{},"isTrackingActivity":false,"isUserActive":true,"otherPublicationStats":{}},"pullRefresh":{"shouldRefresh":false},"sandbox":{"articleIds":[],"articleRefs":{},"pagesCount":null,"route":{},"lastVisitedRoute":{},"isLoading":false},"search":{"searchQueryError":null},"settingsOther":{"inputs":{"uiLang":{"errors":[],"ref":null,"value":""},"articlesLangEnglish":{"errors":[],"ref":null,"value":false},"articlesLangRussian":{"errors":[],"ref":null,"value":false},"agreement":{"errors":[],"ref":null,"value":false},"email":{"errors":[],"ref":null,"value":true},"digest":{"errors":[],"ref":null,"value":true}}},"similarList":{"similarListIds":[],"similarListRefs":null},"ssr":{"error":null,"isDataLoaded":true,"isDataLoading":false,"isHydrationFailed":false,"isServer":false},"stories":{"stories":[]},"technotext":{"years":[],"technotextDocForNominees":null,"technotextDocForWinners":null,"technotextInfo":{},"technotextInfoLoading":false,"technotextWinners":{},"technotextWinnersLoading":false},"userHubsContribution":{"contributionRefs":{"hubRefs":{},"hubIds":{}}},"userInvites":{"availableInvites":0,"usedInvitesIds":[],"usedInvitesRefs":{},"usedInvitesPagesCount":0,"unusedInvitesIds":[],"unusedInvitesRefs":{},"unusedInvitesPagesCount":0},"userVotes":{"karmaVotesList":[],"karmaVotesPagesCount":null,"karmaVotesListLoading":false,"commentsVotesList":[],"commentsVotesPagesCount":null,"commentsVotesListLoading":false,"postsVotesList":[],"postsVotesPagesCount":null,"postsVotesListLoading":false,"userVotesList":[],"userVotesPagesCount":null,"userVotesListLoading":false},"users":{"authorRefs":{},"authorIds":{},"pagesCount":{},"authorProfiles":{},"userHubs":{},"userInvitations":{},"authorFollowers":{},"authorFollowed":{},"userSpecialization":{},"karmaStats":[],"statistics":null,"isLoading":false,"authorFollowersLoading":false,"authorFollowedLoading":false,"userHubsLoading":false,"userInvitationsLoading":false,"route":{}},"viewport":{"prevScrollY":{},"scrollY":0,"width":0},"tracker":{"notificationsLoading":false,"notificationsList":[],"notificationsPageCount":0,"pendingMarkNotificationsRead":[],"publicationsLoading":true,"publicationsList":[],"publicationsPageCount":0,"pendingDeletePublications":false,"pendingMarkPublicationsRead":false},"events":{"eventRefs":{},"eventIds":[],"pagesCount":0,"categories":[],"cities":[],"actualEvents":null,"currentEvent":null,"eventsFilter":{"city":"all","timeStarted":null,"timeEnded":null}},"wysiwyg":{"WYSIWYGRulesRefs":null},"hint":{"hints":{}}};(function(){var s;(s=document.currentScript||document.scripts[document.scripts.length-1]).parentNode.removeChild(s);}()); window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)}; m[i].l=1*new Date();k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)}) (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym"); window.addEventListener('load', function () { setTimeout(() => { const img = new Image(); img.src = 'https://vk.com/rtrg?p=VK-RTRG-421343-57vKE'; }, 0); });